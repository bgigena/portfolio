version: '3.8'

services:
  cloudflared:
    image: cloudflare/cloudflared:latest
    container_name: cloudflared
    restart: unless-stopped
    command: tunnel run --token ${TUNNEL_TOKEN}
    env_file:
      - .env
    ports:
      - "127.0.0.1:8080:80" # Bind to localhost only for debugging if needed, or remove entirely.
    # On Windows, 'host' network mode is limited.
    # We will use the default bridge and access host services via 'host.docker.internal'

  nginx:
    build: ..
    container_name: nginx-portfolio
    restart: unless-stopped
    # Ports removed to force traffic through the tunnel
    # ports:
    #   - "8888:80"
    depends_on:
      - cloudflared
